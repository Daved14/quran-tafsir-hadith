<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
    
    <!-- ===== PWA Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ===== -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#d4af37">
    
    <!-- ===== iOS Safari Ø§Ù„Ù…ÙØ­Ø³ÙÙ‘Ù† ===== -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- ===== Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª iOS ===== -->
    <link rel="apple-touch-icon" href="icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-167x167.png">
    
    <!-- ===== Splash Screens Ù„Ù€ iOS ===== -->
    <!-- iPhone X / XS / 11 Pro -->
    <link rel="apple-touch-startup-image" 
          href="splash/splash-1125x2436.png"
          media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
    
    <!-- iPhone XR / 11 -->
    <link rel="apple-touch-startup-image" 
          href="splash/splash-828x1792.png"
          media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)">
    
    <!-- iPhone 12/13/14 -->
    <link rel="apple-touch-startup-image" 
          href="splash/splash-1170x2532.png"
          media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">
    
    <!-- iPhone 12/13/14 Pro Max -->
    <link rel="apple-touch-startup-image" 
          href="splash/splash-1284x2778.png"
          media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3)">
    
    <!-- iPhone 14 Pro -->
    <link rel="apple-touch-startup-image" 
          href="splash/splash-1179x2556.png"
          media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">
    
    <!-- iPhone 14 Pro Max -->
    <link rel="apple-touch-startup-image" 
          href="splash/splash-1290x2796.png"
          media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)">
    
    <!-- ===== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===== -->
    <meta name="application-name" content="Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…">
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø´Ø§Ù…Ù„ - Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø´Ø±ÙŠÙØŒ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©ØŒ Ø§Ù„Ø£Ø°Ø§Ù†">
    <meta name="author" content="Your Name">
    
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: #0a0a0f;
            color: #fff;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* ========== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ========== */
        .top-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(180deg, #0f0f15 0%, rgba(15,15,21,0.97) 100%);
            border-bottom: 1px solid #1a1a25;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .back-section {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: #4ecdc4;
            font-size: 0.95rem;
            text-decoration: none;
            transition: opacity 0.3s;
        }
        
        .back-section:hover {
            opacity: 0.7;
        }
        
        .back-arrow {
            font-size: 1.3rem;
        }
        
        .page-title {
            color: #fff;
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .refresh-btn {
            background: none;
            border: none;
            color: #4ecdc4;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
        }
        
        .refresh-btn:hover {
            transform: rotate(180deg);
        }
        
        /* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
        .main-content {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px 15px 100px;
        }
        
        /* ========== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù„Ø®Øµ ========== */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .summary-card {
            background: linear-gradient(145deg, #13131a, #0f0f15);
            border: 1px solid #1a1a25;
            border-radius: 16px;
            padding: 18px 15px;
            text-align: center;
            transition: transform 0.3s, border-color 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-3px);
            border-color: #4ecdc4;
        }
        
        .summary-card.highlight {
            background: linear-gradient(145deg, #1a3a38, #0f2a28);
            border-color: #4ecdc4;
        }
        
        .summary-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 4px;
        }
        
        .summary-label {
            font-size: 0.85rem;
            color: #888;
        }
        
        .summary-change {
            font-size: 0.75rem;
            margin-top: 8px;
            padding: 3px 10px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .summary-change.positive {
            background: rgba(46, 204, 113, 0.15);
            color: #2ecc71;
        }
        
        .summary-change.negative {
            background: rgba(231, 76, 60, 0.15);
            color: #e74c3c;
        }
        
        /* ========== Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ========== */
        .chart-section {
            background: linear-gradient(145deg, #13131a, #0f0f15);
            border: 1px solid #1a1a25;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title-icon {
            color: #4ecdc4;
        }
        
        .period-selector {
            display: flex;
            gap: 8px;
        }
        
        .period-btn {
            background: #1a1a25;
            border: none;
            color: #888;
            padding: 6px 14px;
            border-radius: 20px;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .period-btn.active {
            background: #4ecdc4;
            color: #000;
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            margin-bottom: 15px;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.8rem;
            color: #888;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .legend-dot.current {
            background: #4ecdc4;
        }
        
        .legend-dot.average {
            background: #f39c12;
        }
        
        /* ========== Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ ========== */
        .progress-section {
            background: linear-gradient(145deg, #13131a, #0f0f15);
            border: 1px solid #1a1a25;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .khatma-progress {
            margin-top: 20px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .progress-title {
            font-size: 0.95rem;
            color: #fff;
        }
        
        .progress-percentage {
            font-size: 1.1rem;
            font-weight: 700;
            color: #4ecdc4;
        }
        
        .progress-bar-container {
            background: #1a1a25;
            border-radius: 12px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            border-radius: 12px;
            transition: width 1s ease;
            position: relative;
        }
        
        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-details {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #888;
        }
        
        .progress-pages {
            color: #4ecdc4;
            font-weight: 600;
        }
        
        /* ========== Ù‚Ø³Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙØ­Ø§Øª ========== */
        .input-section {
            background: linear-gradient(145deg, #13131a, #0f0f15);
            border: 1px solid #1a1a25;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .input-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .input-field {
            flex: 1;
            background: #1a1a25;
            border: 2px solid #252530;
            border-radius: 12px;
            padding: 14px 16px;
            color: #fff;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .input-field:focus {
            border-color: #4ecdc4;
        }
        
        .input-field::placeholder {
            color: #555;
        }
        
        .add-btn {
            background: linear-gradient(145deg, #4ecdc4, #44a08d);
            border: none;
            color: #000;
            padding: 14px 25px;
            border-radius: 12px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }
        
        .add-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.3);
        }
        
        .add-btn:active {
            transform: scale(0.98);
        }
        
        /* ========== Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ========== */
        .history-section {
            background: linear-gradient(145deg, #13131a, #0f0f15);
            border: 1px solid #1a1a25;
            border-radius: 20px;
            padding: 20px;
        }
        
        .history-list {
            max-height: 250px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #1a1a25;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-date {
            color: #888;
            font-size: 0.9rem;
        }
        
        .history-pages {
            color: #4ecdc4;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .history-pages span {
            color: #666;
            font-weight: 400;
            font-size: 0.85rem;
        }
        
        /* ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© ========== */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }
        
        .celebration-overlay.show {
            display: flex;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .celebration-content {
            text-align: center;
            z-index: 10;
            padding: 20px;
        }
        
        .celebration-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .celebration-title {
            font-size: 2rem;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        .celebration-subtitle {
            font-size: 1.2rem;
            color: #fff;
            margin-bottom: 10px;
        }
        
        .celebration-text {
            font-size: 1rem;
            color: #888;
            margin-bottom: 30px;
            max-width: 300px;
        }
        
        .celebration-btn {
            background: linear-gradient(145deg, #4ecdc4, #44a08d);
            border: none;
            color: #000;
            padding: 15px 40px;
            border-radius: 30px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .celebration-btn:hover {
            transform: scale(1.05);
        }
        
        /* ========== ØªØ£Ø«ÙŠØ± Confetti ========== */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }
        
        .confetti.active {
            animation: confetti-fall 3s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
        
        /* ========== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ ========== */
        .weekly-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #1a1a25, #13131a);
            border: 2px solid #4ecdc4;
            border-radius: 25px;
            padding: 30px;
            max-width: 350px;
            width: 90%;
            z-index: 500;
            display: none;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .weekly-alert.show {
            display: block;
            animation: slideIn 0.4s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .alert-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 499;
            display: none;
        }
        
        .alert-backdrop.show {
            display: block;
        }
        
        .alert-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .alert-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        .alert-stats {
            background: #0f0f15;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .alert-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #1a1a25;
        }
        
        .alert-stat-row:last-child {
            border-bottom: none;
        }
        
        .alert-stat-label {
            color: #888;
        }
        
        .alert-stat-value {
            color: #4ecdc4;
            font-weight: 600;
        }
        
        .alert-comparison {
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .alert-comparison.better {
            background: rgba(46, 204, 113, 0.15);
            color: #2ecc71;
        }
        
        .alert-comparison.worse {
            background: rgba(231, 76, 60, 0.15);
            color: #e74c3c;
        }
        
        .alert-close-btn {
            background: #4ecdc4;
            border: none;
            color: #000;
            padding: 12px 30px;
            border-radius: 25px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* ========== Ø§Ù„ØªØ¬Ø§ÙˆØ¨ÙŠØ© ========== */
        @media (max-width: 400px) {
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .summary-value {
                font-size: 1.5rem;
            }
            
            .input-row {
                flex-direction: column;
            }
            
            .add-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <!-- ========== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ========== -->
    <header class="top-header">
        <a href="index.html" class="back-section">
            <span class="back-arrow">â†’</span>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <h1 class="page-title">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h1>
        <button class="refresh-btn" onclick="refreshData()" title="ØªØ­Ø¯ÙŠØ«">ğŸ”„</button>
    </header>

    <!-- ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== -->
    <main class="main-content">
        
        <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ -->
        <div class="summary-cards">
            <div class="summary-card highlight">
                <div class="summary-icon">ğŸ“–</div>
                <div class="summary-value" id="today-pages">0</div>
                <div class="summary-label">ØµÙØ­Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
            <div class="summary-card">
                <div class="summary-icon">ğŸ“…</div>
                <div class="summary-value" id="week-pages">0</div>
                <div class="summary-label">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                <div class="summary-change positive" id="week-change">â†‘ 0%</div>
            </div>
            <div class="summary-card">
                <div class="summary-icon">ğŸ“ˆ</div>
                <div class="summary-value" id="daily-average">0</div>
                <div class="summary-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
            </div>
            <div class="summary-card">
                <div class="summary-icon">ğŸ†</div>
                <div class="summary-value" id="total-khatmat">0</div>
                <div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø®ØªÙ…Ø§Øª</div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ -->
        <div class="chart-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-title-icon">ğŸ“Š</span>
                    Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
                </div>
                <div class="period-selector">
                    <button class="period-btn active" onclick="setPeriod('week')">Ø£Ø³Ø¨ÙˆØ¹</button>
                    <button class="period-btn" onclick="setPeriod('month')">Ø´Ù‡Ø±</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="weeklyChart"></canvas>
            </div>
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-dot current"></div>
                    <span>Ø§Ù„ØµÙØ­Ø§Øª</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot average"></div>
                    <span>Ø§Ù„Ù…ØªÙˆØ³Ø·</span>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø¯Ù… Ù†Ø­Ùˆ Ø§Ù„Ø®ØªÙ…Ø© -->
        <div class="progress-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-title-icon">ğŸ¯</span>
                    Ø§Ù„ØªÙ‚Ø¯Ù… Ù†Ø­Ùˆ Ø§Ù„Ø®ØªÙ…Ø©
                </div>
            </div>
            <div class="khatma-progress">
                <div class="progress-header">
                    <span class="progress-title">Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>
                    <span class="progress-percentage" id="khatma-percentage">0%</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="khatma-progress-bar" style="width: 0%"></div>
                </div>
                <div class="progress-details">
                    <span>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…: 604 ØµÙØ­Ø©</span>
                    <span class="progress-pages"><span id="current-khatma-pages">0</span> ØµÙØ­Ø©</span>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØµÙØ­Ø§Øª -->
        <div class="input-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-title-icon">âœï¸</span>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
                </div>
            </div>
            <div class="input-row">
                <input type="number" class="input-field" id="pages-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª..." min="1" max="604">
                <button class="add-btn" onclick="addPages()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>

        <!-- Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© -->
        <div class="history-section">
            <div class="section-header">
                <div class="section-title">
                    <span class="section-title-icon">ğŸ“œ</span>
                    Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
                </div>
            </div>
            <div class="history-list" id="history-list">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ù€ JavaScript -->
            </div>
        </div>

    </main>

    <!-- ========== Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© ========== -->
    <div class="celebration-overlay" id="celebration-overlay">
        <div class="celebration-content">
            <div class="celebration-icon">ğŸ‰</div>
            <h2 class="celebration-title">Ù…Ø¨Ø§Ø±Ùƒ!</h2>
            <h3 class="celebration-subtitle">Ù„Ù‚Ø¯ Ø®ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h3>
            <p class="celebration-text">Ø¬Ø¹Ù„Ù‡ Ø§Ù„Ù„Ù‡ ÙÙŠ Ù…ÙŠØ²Ø§Ù† Ø­Ø³Ù†Ø§ØªÙƒ ÙˆØ£Ø¹Ø§Ù†Ùƒ Ø¹Ù„Ù‰ Ø®ØªÙ…Ø§Øª ÙƒØ«ÙŠØ±Ø©</p>
            <button class="celebration-btn" onclick="closeCelebration()">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ âœ¨</button>
        </div>
    </div>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ ========== -->
    <div class="alert-backdrop" id="alert-backdrop" onclick="closeWeeklyAlert()"></div>
    <div class="weekly-alert" id="weekly-alert">
        <div class="alert-icon">ğŸ“Š</div>
        <h3 class="alert-title">Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
        <div class="alert-stats">
            <div class="alert-stat-row">
                <span class="alert-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙØ­Ø§Øª</span>
                <span class="alert-stat-value" id="alert-total">0</span>
            </div>
            <div class="alert-stat-row">
                <span class="alert-stat-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
                <span class="alert-stat-value" id="alert-average">0</span>
            </div>
            <div class="alert-stat-row">
                <span class="alert-stat-label">Ø£ÙØ¶Ù„ ÙŠÙˆÙ…</span>
                <span class="alert-stat-value" id="alert-best">0</span>
            </div>
        </div>
        <div class="alert-comparison better" id="alert-comparison">
            â†‘ Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨Ù€ 20%
        </div>
        <button class="alert-close-btn" onclick="closeWeeklyAlert()">Ø­Ø³Ù†Ø§Ù‹</button>
    </div>

    <!-- ========== JavaScript ========== -->
    <script>
        // ========== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø«ÙˆØ§Ø¨Øª ==========
        const TOTAL_QURAN_PAGES = 604;
        let weeklyChart = null;
        let readingData = JSON.parse(localStorage.getItem('quran_reading_data')) || {};
        let khatmatCount = parseInt(localStorage.getItem('khatmat_count')) || 0;
        let currentKhatmaPages = parseInt(localStorage.getItem('current_khatma_pages')) || 0;

        // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ==========
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            updateAllStats();
            renderHistory();
            checkWeeklyAlert();
        });

        // ========== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ==========
        function initChart() {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            const weekData = getWeekData();
            const average = weekData.reduce((a, b) => a + b, 0) / 7;

            weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ø³Ø¨Øª', 'Ø£Ø­Ø¯', 'Ø¥Ø«Ù†ÙŠÙ†', 'Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø®Ù…ÙŠØ³', 'Ø¬Ù…Ø¹Ø©'],
                    datasets: [{
                        label: 'Ø§Ù„ØµÙØ­Ø§Øª',
                        data: weekData,
                        backgroundColor: 'rgba(78, 205, 196, 0.8)',
                        borderColor: '#4ecdc4',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: average,
                                    yMax: average,
                                    borderColor: '#f39c12',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#888'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#888'
                            }
                        }
                    }
                }
            });

            // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø§Ù„Ù…ØªÙˆØ³Ø·
            addAverageLine(average);
        }

        function addAverageLine(average) {
            if (weeklyChart.data.datasets.length < 2) {
                weeklyChart.data.datasets.push({
                    label: 'Ø§Ù„Ù…ØªÙˆØ³Ø·',
                    data: Array(7).fill(average),
                    type: 'line',
                    borderColor: '#f39c12',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false
                });
                weeklyChart.update();
            }
        }

        // ========== Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ==========
        function getWeekData() {
            const weekData = [];
            const today = new Date();
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ø§Ù„Ø³Ø¨Øª)
            const dayOfWeek = today.getDay();
            const diff = dayOfWeek === 6 ? 0 : dayOfWeek + 1;
            const saturday = new Date(today);
            saturday.setDate(today.getDate() - diff);

            for (let i = 0; i < 7; i++) {
                const date = new Date(saturday);
                date.setDate(saturday.getDate() + i);
                const dateKey = formatDate(date);
                weekData.push(readingData[dateKey] || 0);
            }

            return weekData;
        }

        // ========== Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ ==========
        function getLastWeekData() {
            const weekData = [];
            const today = new Date();
            
            const dayOfWeek = today.getDay();
            const diff = dayOfWeek === 6 ? 7 : dayOfWeek + 8;
            const lastSaturday = new Date(today);
            lastSaturday.setDate(today.getDate() - diff);

            for (let i = 0; i < 7; i++) {
                const date = new Date(lastSaturday);
                date.setDate(lastSaturday.getDate() + i);
                const dateKey = formatDate(date);
                weekData.push(readingData[dateKey] || 0);
            }

            return weekData;
        }

        // ========== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ==========
        function formatDate(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // ========== Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø§Øª ==========
        function addPages() {
            const input = document.getElementById('pages-input');
            const pages = parseInt(input.value);

            if (!pages || pages < 1) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­', 'error');
                return;
            }

            const today = formatDate(new Date());
            readingData[today] = (readingData[today] || 0) + pages;
            currentKhatmaPages += pages;

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            localStorage.setItem('quran_reading_data', JSON.stringify(readingData));
            localStorage.setItem('current_khatma_pages', currentKhatmaPages);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateAllStats();
            updateChart();
            renderHistory();

            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
            input.value = '';

            // Ø§Ù‡ØªØ²Ø§Ø² Ø®ÙÙŠÙ
            if (navigator.vibrate) navigator.vibrate(50);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†
            checkKhatmaCompletion();

            showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${pages} ØµÙØ­Ø© âœ“`, 'success');
        }

        // ========== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø®ØªÙ… Ø§Ù„Ù‚Ø±Ø¢Ù† ==========
        function checkKhatmaCompletion() {
            if (currentKhatmaPages >= TOTAL_QURAN_PAGES) {
                khatmatCount++;
                currentKhatmaPages = currentKhatmaPages - TOTAL_QURAN_PAGES;
                
                localStorage.setItem('khatmat_count', khatmatCount);
                localStorage.setItem('current_khatma_pages', currentKhatmaPages);

                // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø©
                showCelebration();
            }
        }

        // ========== Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© ==========
        function showCelebration() {
            const overlay = document.getElementById('celebration-overlay');
            overlay.classList.add('show');
            
            // Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Confetti
            createConfetti();
        }

        function closeCelebration() {
            const overlay = document.getElementById('celebration-overlay');
            overlay.classList.remove('show');
            updateAllStats();
        }

        // ========== ØªØ£Ø«ÙŠØ± Confetti ==========
        function createConfetti() {
            const colors = ['#4ecdc4', '#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#2ecc71'];
            const overlay = document.getElementById('celebration-overlay');

            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-20px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    overlay.appendChild(confetti);

                    setTimeout(() => confetti.classList.add('active'), 10);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        // ========== ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ==========
        function updateAllStats() {
            const today = formatDate(new Date());
            const todayPages = readingData[today] || 0;
            const weekData = getWeekData();
            const lastWeekData = getLastWeekData();
            const weekTotal = weekData.reduce((a, b) => a + b, 0);
            const lastWeekTotal = lastWeekData.reduce((a, b) => a + b, 0);
            const dailyAvg = Math.round(weekTotal / 7);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            document.getElementById('today-pages').textContent = todayPages;
            document.getElementById('week-pages').textContent = weekTotal;
            document.getElementById('daily-average').textContent = dailyAvg;
            document.getElementById('total-khatmat').textContent = khatmatCount;

            // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±
            const changeEl = document.getElementById('week-change');
            if (lastWeekTotal > 0) {
                const change = Math.round(((weekTotal - lastWeekTotal) / lastWeekTotal) * 100);
                if (change >= 0) {
                    changeEl.textContent = `â†‘ ${change}%`;
                    changeEl.className = 'summary-change positive';
                } else {
                    changeEl.textContent = `â†“ ${Math.abs(change)}%`;
                    changeEl.className = 'summary-change negative';
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            const percentage = Math.round((currentKhatmaPages / TOTAL_QURAN_PAGES) * 100);
            document.getElementById('khatma-percentage').textContent = percentage + '%';
            document.getElementById('khatma-progress-bar').style.width = percentage + '%';
            document.getElementById('current-khatma-pages').textContent = currentKhatmaPages;
        }

        // ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ==========
        function updateChart() {
            const weekData = getWeekData();
            const average = weekData.reduce((a, b) => a + b, 0) / 7;

            weeklyChart.data.datasets[0].data = weekData;
            if (weeklyChart.data.datasets[1]) {
                weeklyChart.data.datasets[1].data = Array(7).fill(average);
            }
            weeklyChart.update();
        }

        // ========== Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ==========
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            const entries = Object.entries(readingData).sort((a, b) => new Date(b[0]) - new Date(a[0])).slice(0, 10);

            if (entries.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¨Ø¹Ø¯</p>';
                return;
            }

            historyList.innerHTML = entries.map(([date, pages]) => {
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('ar-SA', { 
                    weekday: 'long', 
                    month: 'short', 
                    day: 'numeric' 
                });
                return `
                    <div class="history-item">
                        <span class="history-date">${formattedDate}</span>
                        <span class="history-pages">${pages} <span>ØµÙØ­Ø©</span></span>
                    </div>
                `;
            }).join('');
        }

        // ========== Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ ==========
        function checkWeeklyAlert() {
            const lastAlertDate = localStorage.getItem('last_weekly_alert');
            const today = new Date();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ø§Ù„Ø¬Ù…Ø¹Ø©
            if (today.getDay() === 5) {
                const todayStr = formatDate(today);
                if (lastAlertDate !== todayStr) {
                    showWeeklyAlert();
                    localStorage.setItem('last_weekly_alert', todayStr);
                }
            }
        }

        function showWeeklyAlert() {
            const weekData = getWeekData();
            const lastWeekData = getLastWeekData();
            const weekTotal = weekData.reduce((a, b) => a + b, 0);
            const lastWeekTotal = lastWeekData.reduce((a, b) => a + b, 0);
            const average = Math.round(weekTotal / 7);
            const bestDay = Math.max(...weekData);

            document.getElementById('alert-total').textContent = weekTotal + ' ØµÙØ­Ø©';
            document.getElementById('alert-average').textContent = average + ' ØµÙØ­Ø©';
            document.getElementById('alert-best').textContent = bestDay + ' ØµÙØ­Ø©';

            const comparison = document.getElementById('alert-comparison');
            if (lastWeekTotal > 0) {
                const change = Math.round(((weekTotal - lastWeekTotal) / lastWeekTotal) * 100);
                if (change >= 0) {
                    comparison.textContent = `â†‘ Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨Ù€ ${change}%`;
                    comparison.className = 'alert-comparison better';
                } else {
                    comparison.textContent = `â†“ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨Ù€ ${Math.abs(change)}%`;
                    comparison.className = 'alert-comparison worse';
                }
            } else {
                comparison.textContent = 'Ù‡Ø°Ø§ Ø£ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹ Ù„ÙƒØŒ Ø§Ø³ØªÙ…Ø±!';
                comparison.className = 'alert-comparison better';
            }

            document.getElementById('alert-backdrop').classList.add('show');
            document.getElementById('weekly-alert').classList.add('show');
        }

        function closeWeeklyAlert() {
            document.getElementById('alert-backdrop').classList.remove('show');
            document.getElementById('weekly-alert').classList.remove('show');
        }

        // ========== ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙØªØ±Ø© ==========
        function setPeriod(period) {
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø±
        }

        // ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
        function refreshData() {
            updateAllStats();
            updateChart();
            renderHistory();
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
        }

        // ========== Ø±Ø³Ø§Ù„Ø© Toast ==========
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#2ecc71' : '#e74c3c'};
                color: #fff;
                padding: 12px 25px;
                border-radius: 25px;
                font-family: 'Tajawal', sans-serif;
                z-index: 1000;
                animation: fadeInUp 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // Ø²Ø± Enter Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙØ­Ø§Øª
        document.getElementById('pages-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addPages();
        });
    </script>

</body>
</html>